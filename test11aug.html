<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>17:46-aud11-Notes Test Harness</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <h1>ðŸ§ª Supabase Notes Test</h1>

  <button id="test-fetch">Fetch Notes</button>
  <button id="test-insert">Insert Note</button>
  <button id="test-update">Update Status</button>

  <pre id="output" style="margin-top: 1em; background: #f0f0f0; padding: 1em;"></pre>

  <script type="module">
    import { createSupabaseClient } from './db/client.js';
    import { fetchNotes, insertNote, saveNoteStatus } from './db/notes.js';

    const supabase = createSupabaseClient();
    const output = document.getElementById('output');

    function log(message) {
      output.textContent += message + '\n';
      console.log(message);
    }

    document.getElementById('test-fetch').addEventListener('click', async () => {
      log('Fetching notes...');
      const { data, count } = await fetchNotes(supabase, 1);
      log(`Fetched ${data.length} notes (Total: ${count})`);
      data.forEach(note => log(`- ${note.id}: ${note.title}`));
    });

    document.getElementById('test-insert').addEventListener('click', async () => {
      log('Inserting test note...');
      const authorId = '47742c9f-9afd-40b3-816a-f83fcd72b905'; // Replace with a valid UUID
      
      const newId = await insertNote(supabase, authorId, null, null, 'Harness test', 'This is sent from the Noyes Test Harness using the new notes.js file.', 6);
      if (newId) {
        log(`âœ“ Inserted note with ID: ${newId}`);
      } else {
        log('âœ— Insert failed');
      }
    });

    document.getElementById('test-update').addEventListener('click', async () => {
      const testNoteId = prompt('Enter note ID to update status:');
      const newStatus = parseInt(prompt('Enter new status (6, 7, 8, 9):'), 10);
      if (!testNoteId || isNaN(newStatus)) {
        log('âœ— Invalid input');
        return;
      }
      log(`Updating note ${testNoteId} to status ${newStatus}...`);
const { data, error } = await saveNoteStatus(testNoteId, newStatus);


if (error) {
  log('âœ— Update failed');
  log(JSON.stringify(error, null, 2));
} else {
  log(`âœ“ Status updated`);
  log(`Updated note: ${JSON.stringify(data, null, 2)}`);
}

    });
  </script>
</body>
</html>
